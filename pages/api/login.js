import jwt from 'jsonwebtoken'; import bcrypt from 'bcryptjs'; import { PrismaClient } from '@prisma/client'; const prisma = new PrismaClient();
export default async function handler(req,res){ if(req.method!=='POST') return res.status(405).end(); const {email,password}=req.body; const user=await prisma.user.findUnique({where:{email}}); if(!user) return res.status(401).json({message:'Invalid email'}); const valid=await bcrypt.compare(password,user.passwordHash); if(!valid) return res.status(401).json({message:'Invalid password'}); const token=jwt.sign({id:user.id,role:user.role},process.env.JWT_SECRET,{expiresIn:'8h'}); res.status(200).json({token}); }